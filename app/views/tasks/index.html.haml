タスク一覧

= search_form_for @q do |f| 

  = f.label :name, "キーワード検索"
  = f.search_field :name_cont

  = f.label :category_id, "カテゴリー検索"
  = f.collection_select :category_id, current_user.categories.all, :id, :name, include_blank: '選択してください'

  = f.label :client_id, "依頼元検索"
  = f.collection_select :client_id, current_user.clients.all, :id, :name, include_blank: '選択してください'

  = f.label :duedate, "期限"
  = f.date_field :duedate_gteq
  = f.date_field :duedate_lteq

  = f.submit "検索"
  = link_to '検索条件のクリア', request.path

%table
  %thead
    %tr
      %th 
        = sort_link(@q, :name, "名前")
      %th
        = sort_link(@q, :category_name, "カテゴリー")
      %th
        = sort_link(@q, :client_name, "依頼元")
      %th
        = sort_link(@q, :duedate, "期限")
      %th
        = sort_link(@q, :status_id, "状態")
      %th
        = sort_link(@q, :user, "担当")

  %tbody
    - @results.each do |result|
      %tr
        = form_for(result, url: task_path(result.id)) do |f|
          - if result.errors.any?
            #error_explanation
              %h2
                = pluralize(result.errors.count, "error")
                prohibited this user from being saved:

            %ul
              - result.errors.full_messages.each do |message|
                %li 
                  = message
          %td.field
            = f.text_field :name
          %td.field
            = f.collection_select :category_id, current_user.categories.all, :id, :name
          %td.field
            = f.collection_select :client_id, current_user.clients.all, :id, :name
          %td.field
            = f.date_select :duedate
          %td.field
            = f.collection_select :status_id, Status.all, :id, :name
          %td
            = result.user.name
          %td
            = f.submit '変更'
          %td
            = link_to '削除', task_path(result.id), method: :delete, data: { confirm: '削除しますか?' }
          %td
            = link_to '詳細',  edit_taskdetail_path(result.id)
    %tr
      = form_for(@new_task) do |f|
        - if @new_task.errors.any?
          #error_explanation
            %h2
              = pluralize(@new_task.errors.count, "error")
              prohibited this user from being saved:

          %ul
            - @new_task.errors.full_messages.each do |message|
              %li 
                = message

        %td.field
          = f.text_field :name
        %td.field
          = f.collection_select :category_id, current_user.categories.all, :id, :name
        %td.field
          = f.collection_select :client_id, current_user.clients.all, :id, :name
        %td.field
          = f.date_select :duedate
        %td.field
          = f.collection_select :status_id, Status.all, :id, :name
        %td.field
          = f.hidden_field :user_id, value: current_user.id
          = current_user.name
        %td.actions
          = f.submit '作成'

%section.flash-area
  -flash. each do |key, value|
    = content_tag(:div, value, class: "#key")